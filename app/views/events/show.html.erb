<!DOCTYPE html>
<html>
  <head>
    <title>Bunny Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        width: 75%;
        height: 400px;
        background-color: #666;
        /* position: absolute; */
        top: 0px;
        right: 0px;
        left: 0px;
        bottom: 0;
        /* margin: auto; */
      }

      .event-img {
        width: 100%;
      }
    </style>
  </head>
  <body>

    <div class="event-img">
      <%= activity_img(@event) %>
    </div>
    <%= simple_form_for @event do |f| %>
    <table class="table">

      <thead>
        <tr>
          <th scope="col" colspan="2"><h2><%= f.object.event_name %></h2></th>
      </thead>
      <tbody>
        <tr>
          <th scope="row">報名截止</th>
          <td><%= f.object.apply_end %></td>
        </tr>
        <tr>
          <th scope="row">活動種類</th>
          <td><%= f.object.event_type %></td>
        </tr>
        <tr>
          <th scope="row">活動日期</th>
          <td><%= f.object.event_start %> ~ <%= f.object.event_end %></td>
        </tr>
        <tr>
          <th scope="row">揪團人數(最低成團人數~人數上限)</th>
          <td><%= f.object.min_attend %>人 ~ <%= f.object.max_attend %>人</td>
        </tr>
        <tr>
          <th scope="row">活動說明</th>
          <td><%= f.object.description %></td>
        </tr>
        <tr>
          <th scope="row">活動地址</th>
          <td><span id="location2"><%= f.object.location %></span></td>
        </tr>
      </tbody>
    </table>
    <% end %>

    <div id="map"></div>
    <% if user_signed_in? && policy(@event).edit? %>
      <%= link_to "編輯活動", edit_event_path(@event), class: "btn btn-primary"%>
      <%= link_to "刪除活動", event_path(@event), class: "btn btn-danger", method: 'delete', data: {confirm: "確定刪除活動？"} %>
    <% end %>

    <% if policy(@event).apply? %>
      <%= link_to "我要報名", apply_event_path, class: "btn btn-success", method: 'put' %>
    <% end %>
    <% if user_signed_in? && policy(@event).cancel_apply? %>
      <%= link_to "取消報名", cancel_apply_event_path, class: "btn btn-info", method: 'put'  %>
    <% end %>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script>
      var map, geocoder;

      function initMap() {
        geocoder = new google.maps.Geocoder();
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 17
        });
        var address = document.querySelector("#location2").innerHTML;
        console.log(address)
        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == 'OK') {
            map.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
            });
          } else {
            console.log(status);
          }
        });
      }
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%=ENV["google_api_key"]%>&callback=initMap"
    async defer></script>
  </body>
</html>


